<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Omega Base Station</title>

    <link rel="stylesheet" href="/vendor/bootstrap.min.css">
    <style>
        html, body {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="w-100 h-100 bg-dark">
<div class="container h-100 bg-light" id="app">
    <div class="jumbotron">
        <h1>Omega Base Station</h1>
        <p>This is the main configuration and management page of Omega Base
            Station. The project aims at building a field datalogger for
            distributed sensor networks operated by one or many base
            stations build and run on the Onion Omega2+. The sensor nodes
            are connected WiFi enabled sensors. The data transmission shall
            be possible by hand, LoRaWAN (TTN), GSM or WiFi one day.
        </p>
    </div>

    <div class="row">
        <div class="col col-lg-6 col-12">
            <h3>connected devices</h3>
            <device-item v-for="device in devices" v-bind:device="device"></device-item>
        </div>
        <div class="col col-lg-6 col-12">
            <h3>recent payload</h3>
            <payload-preview v-bind:payload="lastPayload" class="w-100" style="height: 500px;"></payload-preview>
        </div>
    </div>
</div>


<!-- scripts -->
<script src="/vendor/vue.js"></script>
<script>
Vue.component('device-item', {
    props: ['device'],
    template: '<div class="card p-3"><h5>{{ device.name ? device.name : "ID: " + device.dev_id }}' +
        '<div class="badge badge-success float-right">Last seen:&nbsp; <div class="badge badge-light">{{ device.last_connection }}</div></div></h5>' +
        '<div>IP: {{ device.dev_ip }}</div></div>'
});

Vue.component('payload-preview', {
    props: ['payload'],
    template: '<textarea class="bg-light card p-3">{{ payload }}</textarea>'
});

var app = new Vue({
    el: '#app',
    data: {
        devices: [],
        lastPayload: ''
    },
    created() {
        fetch('/devices').then(response => response.json())
            .then(json => {
                this.devices = json.devices;
            });
        fetch('/logs?max=5').then(response => response.json()
            .then(json => {
               this.lastPayload = json.logs;
            })
        );
    }
});
</script>
</body>
</html>